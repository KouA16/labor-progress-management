(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{5380:(e,t,s)=>{"use strict";s.d(t,{A:()=>n,AuthProvider:()=>d});var r=s(5155),a=s(2115),l=s(7886);let i=(0,a.createContext)(void 0);function d(e){let{children:t}=e,[s,d]=(0,a.useState)(null),[n,o]=(0,a.useState)(!0);return(0,a.useEffect)(()=>{let e=l.u.getSession();e&&d(e),o(!1)},[]),(0,r.jsx)(i.Provider,{value:{user:s,login:e=>{l.u.saveSession(e),d(e)},logout:()=>{l.u.clearSession(),d(null)},isLoading:n},children:t})}function n(){let e=(0,a.useContext)(i);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},7333:(e,t,s)=>{Promise.resolve().then(s.bind(s,8640))},7886:(e,t,s)=>{"use strict";s.d(t,{u:()=>r});class r{static validateLogin(e){let{role:t,password:s,orgId:r}=e;return"central"===t?"1050"===s:"1234"===s&&!!r}static saveSession(e){localStorage.setItem(this.SESSION_KEY,JSON.stringify({...e,timestamp:Date.now()}))}static getSession(){{let e=localStorage.getItem(this.SESSION_KEY);if(e){let t=JSON.parse(e);if(Date.now()-t.timestamp<2592e6)return{role:t.role,orgId:t.orgId,orgName:t.orgName,isAuthenticated:t.isAuthenticated}}}return null}static clearSession(){localStorage.removeItem(this.SESSION_KEY)}static isAuthenticated(){let e=this.getSession();return(null==e?void 0:e.isAuthenticated)||!1}static getCurrentUser(){return this.getSession()}static canManageCommonTasks(e){return"central"===e}static canManageLocalTasks(e,t,s){return"central"!==e&&t===s}static canViewAllProgress(e){return"central"===e}static canUpdateProgress(e,t,s){return"central"!==e&&t===s}}r.SESSION_KEY="labor_progress_session"},8640:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>O});var r=s(5155),a=s(2115),l=s(5380),i=s(7886),d=s(9708),n=s(2078);let o={apiKey:"AIzaSyAq-N9zXGekpsfcSiJDCaNzakDv0C7DUSo",authDomain:"labor-progress-management.firebaseapp.com",projectId:"labor-progress-management",storageBucket:"labor-progress-management.firebasestorage.app",messagingSenderId:"786259646367",appId:"1:786259646367:web:0dc8b27c7edc21fb508faa"},c=null,m=null,u=()=>{if(c&&m)return{app:c,db:m};try{return c=0===(0,n.Dk)().length?(0,n.Wp)(o):(0,n.Dk)()[0],m=(0,d.aU)(c),{app:c,db:m}}catch(e){return console.error("Firebase initialization failed:",e),{app:null,db:null}}};{let{app:e,db:t}=u();c=e,m=t}class x{static async getOrganizations(){return new Promise(e=>{setTimeout(()=>e([...this.organizations]),100)})}static async getOrganizationById(e){return new Promise(t=>{setTimeout(()=>{t(this.organizations.find(t=>t.id===e)||null)},100)})}static async getOrganizationsByRole(e){return new Promise(t=>{setTimeout(()=>{t(this.organizations.filter(t=>t.role===e))},100)})}static async getTasks(){return new Promise(e=>{setTimeout(()=>e([...this.tasks]),100)})}static async getTasksByCategory(e){return new Promise(t=>{setTimeout(()=>{t(this.tasks.filter(t=>t.category===e&&t.active&&"common"===t.kind))},100)})}static async getTasksByOrganization(e){return new Promise(t=>{setTimeout(()=>{t(this.tasks.filter(t=>t.createdByOrgId===e&&t.active&&"local"===t.kind))},100)})}static async createTask(e){return new Promise(t=>{setTimeout(()=>{let s="task_".concat(Date.now()),r={...e,id:s};this.tasks.push(r),t(s)},100)})}static async updateTask(e,t){return new Promise(s=>{setTimeout(()=>{let r=this.tasks.findIndex(t=>t.id===e);r>=0&&(this.tasks[r]={...this.tasks[r],...t,updatedAt:new Date().toISOString().split("T")[0]}),s()},100)})}static async deleteTask(e){return new Promise(t=>{setTimeout(()=>{this.tasks=this.tasks.filter(t=>t.id!==e),this.progress=this.progress.filter(t=>t.taskId!==e),t()},100)})}static async getProgress(){return new Promise(e=>{setTimeout(()=>e([...this.progress]),100)})}static async getProgressByOrganization(e){return new Promise(t=>{setTimeout(()=>{t(this.progress.filter(t=>t.orgId===e))},100)})}static async getProgressByTask(e){return new Promise(t=>{setTimeout(()=>{t(this.progress.filter(t=>t.taskId===e))},100)})}static async getProgressByTaskAndOrg(e,t){return new Promise(s=>{setTimeout(()=>{s(this.progress.find(s=>s.taskId===e&&s.orgId===t)||null)},100)})}static async createOrUpdateProgress(e,t,s,r){return new Promise(a=>{setTimeout(()=>{let l=this.progress.findIndex(s=>s.taskId===e&&s.orgId===t),i=new Date().toISOString(),d=i.split("T")[0];if(l>=0){let e=this.progress[l],a={status:s,updatedAt:d};void 0!==r&&(a.memo=r,a.memoHistory=[...e.memoHistory||[],{memo:r,orgId:t,timestamp:i}]),"完了"!==s||e.completedAt?"完了"!==s&&e.completedAt&&(a.completedAt=void 0):a.completedAt=d,this.progress[l]={...e,...a}}else{let a={id:"progress_".concat(Date.now()),taskId:e,orgId:t,status:s,memo:r||"",memoHistory:r?[{memo:r,orgId:t,timestamp:i}]:[],completedAt:"完了"===s?d:void 0,updatedAt:d};this.progress.push(a)}a()},100)})}}x.organizations=[{id:"org_000",name:"中央",role:"central",active:!0,displayOrder:0},{id:"org_001",name:"北海道ブロック",role:"block",active:!0,displayOrder:1},{id:"org_002",name:"東北ブロック",role:"block",active:!0,displayOrder:2},{id:"org_003",name:"関東ブロック",role:"block",active:!0,displayOrder:3},{id:"org_004",name:"北陸ブロック",role:"block",active:!0,displayOrder:4},{id:"org_005",name:"東海ブロック",role:"block",active:!0,displayOrder:5},{id:"org_006",name:"近畿ブロック",role:"block",active:!0,displayOrder:6},{id:"org_007",name:"中国ブロック",role:"block",active:!0,displayOrder:7},{id:"org_008",name:"四国ブロック",role:"block",active:!0,displayOrder:8},{id:"org_009",name:"九州ブロック",role:"block",active:!0,displayOrder:9},{id:"org_010",name:"北海道",role:"sub",active:!0,displayOrder:10},{id:"org_011",name:"青森",role:"sub",active:!0,displayOrder:11},{id:"org_012",name:"岩手",role:"sub",active:!0,displayOrder:12},{id:"org_013",name:"宮城",role:"sub",active:!0,displayOrder:13},{id:"org_014",name:"秋田",role:"sub",active:!0,displayOrder:14},{id:"org_015",name:"山形",role:"sub",active:!0,displayOrder:15},{id:"org_016",name:"福島",role:"sub",active:!0,displayOrder:16},{id:"org_017",name:"茨城",role:"sub",active:!0,displayOrder:17},{id:"org_018",name:"栃木",role:"sub",active:!0,displayOrder:18},{id:"org_019",name:"群馬",role:"sub",active:!0,displayOrder:19},{id:"org_020",name:"埼玉",role:"sub",active:!0,displayOrder:20},{id:"org_021",name:"千葉",role:"sub",active:!0,displayOrder:21},{id:"org_022",name:"東京",role:"sub",active:!0,displayOrder:22},{id:"org_023",name:"神奈川",role:"sub",active:!0,displayOrder:23},{id:"org_024",name:"新潟",role:"sub",active:!0,displayOrder:24},{id:"org_025",name:"富山",role:"sub",active:!0,displayOrder:25},{id:"org_026",name:"石川",role:"sub",active:!0,displayOrder:26},{id:"org_027",name:"福井",role:"sub",active:!0,displayOrder:27},{id:"org_028",name:"山梨",role:"sub",active:!0,displayOrder:28},{id:"org_029",name:"長野",role:"sub",active:!0,displayOrder:29},{id:"org_030",name:"岐阜",role:"sub",active:!0,displayOrder:30},{id:"org_031",name:"静岡",role:"sub",active:!0,displayOrder:31},{id:"org_032",name:"愛知",role:"sub",active:!0,displayOrder:32},{id:"org_033",name:"三重",role:"sub",active:!0,displayOrder:33},{id:"org_034",name:"滋賀",role:"sub",active:!0,displayOrder:34},{id:"org_035",name:"京都",role:"sub",active:!0,displayOrder:35},{id:"org_036",name:"大阪",role:"sub",active:!0,displayOrder:36},{id:"org_037",name:"兵庫",role:"sub",active:!0,displayOrder:37},{id:"org_038",name:"奈良",role:"sub",active:!0,displayOrder:38},{id:"org_039",name:"和歌山",role:"sub",active:!0,displayOrder:39},{id:"org_040",name:"鳥取",role:"sub",active:!0,displayOrder:40},{id:"org_041",name:"島根",role:"sub",active:!0,displayOrder:41},{id:"org_042",name:"岡山",role:"sub",active:!0,displayOrder:42},{id:"org_043",name:"広島",role:"sub",active:!0,displayOrder:43},{id:"org_044",name:"山口",role:"sub",active:!0,displayOrder:44},{id:"org_045",name:"徳島",role:"sub",active:!0,displayOrder:45},{id:"org_046",name:"香川",role:"sub",active:!0,displayOrder:46},{id:"org_047",name:"愛媛",role:"sub",active:!0,displayOrder:47},{id:"org_048",name:"高知",role:"sub",active:!0,displayOrder:48},{id:"org_049",name:"福岡",role:"sub",active:!0,displayOrder:49},{id:"org_050",name:"佐賀",role:"sub",active:!0,displayOrder:50},{id:"org_051",name:"長崎",role:"sub",active:!0,displayOrder:51},{id:"org_052",name:"熊本",role:"sub",active:!0,displayOrder:52},{id:"org_053",name:"大分",role:"sub",active:!0,displayOrder:53},{id:"org_054",name:"宮崎",role:"sub",active:!0,displayOrder:54},{id:"org_055",name:"鹿児島",role:"sub",active:!0,displayOrder:55},{id:"org_056",name:"沖縄",role:"sub",active:!0,displayOrder:56},{id:"org_057",name:"旭川",role:"sub",active:!0,displayOrder:57},{id:"org_058",name:"多摩",role:"sub",active:!0,displayOrder:58},{id:"org_059",name:"豊橋",role:"sub",active:!0,displayOrder:59},{id:"org_060",name:"南大阪",role:"sub",active:!0,displayOrder:60},{id:"org_061",name:"北九州",role:"sub",active:!0,displayOrder:61},{id:"org_062",name:"幕張",role:"branch",active:!0,displayOrder:62},{id:"org_063",name:"所沢",role:"branch",active:!0,displayOrder:63},{id:"org_064",name:"吉備",role:"branch",active:!0,displayOrder:64}],x.tasks=[],x.progress=[];let g=()=>{{let{db:e}=u();return null!==e}};class h{static async getOrganizations(){if(!g()||!m)return x.getOrganizations();try{return(await (0,d.GG)((0,d.rJ)(m,"organizations"))).docs.map(e=>({id:e.id,...e.data()})).sort((e,t)=>e.displayOrder-t.displayOrder)}catch(e){return console.warn("Firebase error, using mock data:",e),x.getOrganizations()}}static async getOrganizationById(e){if(!g()||!m)return x.getOrganizationById(e);try{let t=(0,d.H9)(m,"organizations",e),s=await (0,d.x7)(t);if(s.exists())return{id:s.id,...s.data()};return null}catch(t){return console.warn("Firebase error, using mock data:",t),x.getOrganizationById(e)}}static async getOrganizationsByRole(e){if(!g()||!m)return x.getOrganizationsByRole(e);try{return(await (0,d.GG)((0,d.rJ)(m,"organizations"))).docs.map(e=>({id:e.id,...e.data()})).filter(t=>t.role===e).sort((e,t)=>e.displayOrder-t.displayOrder)}catch(t){return console.warn("Firebase error, using mock data:",t),x.getOrganizationsByRole(e)}}static async getTasks(){if(!g()||!m)return x.getTasks();try{return(await (0,d.GG)((0,d.rJ)(m,"tasks"))).docs.map(e=>({id:e.id,...e.data()})).sort((e,t)=>e.createdAt.localeCompare(t.createdAt))}catch(e){return console.warn("Firebase error, using mock data:",e),x.getTasks()}}static async getTasksByCategory(e){if(!g()||!m)return x.getTasksByCategory(e);try{return(await (0,d.GG)((0,d.rJ)(m,"tasks"))).docs.map(e=>({id:e.id,...e.data()})).filter(t=>t.category===e&&t.active&&"common"===t.kind).sort((e,t)=>e.createdAt.localeCompare(t.createdAt))}catch(t){return console.warn("Firebase error, using mock data:",t),x.getTasksByCategory(e)}}static async getTasksByOrganization(e){if(!g()||!m)return x.getTasksByOrganization(e);try{return(await (0,d.GG)((0,d.rJ)(m,"tasks"))).docs.map(e=>({id:e.id,...e.data()})).filter(t=>t.createdByOrgId===e&&t.active&&"local"===t.kind).sort((e,t)=>e.createdAt.localeCompare(t.createdAt))}catch(t){return console.warn("Firebase error, using mock data:",t),x.getTasksByOrganization(e)}}static async createTask(e){if(!g()||!m)return x.createTask(e);try{return(await (0,d.gS)((0,d.rJ)(m,"tasks"),e)).id}catch(t){return console.warn("Firebase error, using mock data:",t),x.createTask(e)}}static async updateTask(e,t){if(!m)throw Error("Database not initialized");let s=(0,d.H9)(m,"tasks",e);await (0,d.mZ)(s,{...t,updatedAt:new Date().toISOString().split("T")[0]})}static async deleteTask(e){if(!m)throw Error("Database not initialized");let t=(0,d.wP)(m),s=(0,d.H9)(m,"tasks",e);t.delete(s);let r=(0,d.P)((0,d.rJ)(m,"progress"),(0,d._M)("taskId","==",e));(await (0,d.GG)(r)).docs.forEach(e=>{t.delete(e.ref)}),await t.commit()}static async getProgress(){if(!g()||!m)return x.getProgress();try{return(await (0,d.GG)((0,d.rJ)(m,"progress"))).docs.map(e=>({id:e.id,...e.data()})).sort((e,t)=>t.updatedAt.localeCompare(e.updatedAt))}catch(e){return console.warn("Firebase error, using mock data:",e),x.getProgress()}}static async getProgressByOrganization(e){if(!g()||!m)return x.getProgressByOrganization(e);try{return(await (0,d.GG)((0,d.rJ)(m,"progress"))).docs.map(e=>({id:e.id,...e.data()})).filter(t=>t.orgId===e).sort((e,t)=>t.updatedAt.localeCompare(e.updatedAt))}catch(t){return console.warn("Firebase error, using mock data:",t),x.getProgressByOrganization(e)}}static async getProgressByTask(e){return m?(await (0,d.GG)((0,d.P)((0,d.rJ)(m,"progress"),(0,d._M)("taskId","==",e),(0,d.My)("updatedAt","desc")))).docs.map(e=>({id:e.id,...e.data()})):[]}static async getProgressByTaskAndOrg(e,t){if(!m)return null;let s=await (0,d.GG)((0,d.P)((0,d.rJ)(m,"progress"),(0,d._M)("taskId","==",e),(0,d._M)("orgId","==",t)));if(!s.empty){let e=s.docs[0];return{id:e.id,...e.data()}}return null}static async createOrUpdateProgress(e,t,s,r){let{db:a}=u();if(!g()||!a)return x.createOrUpdateProgress(e,t,s,r);try{let l=await this.getProgressByTaskAndOrg(e,t),i=new Date().toISOString(),n=i.split("T")[0];if(l){let e={status:s,updatedAt:n};if(void 0!==r&&(e.memo=r,e.memoHistory=[...l.memoHistory||[],{memo:r,orgId:t,timestamp:i}]),"完了"!==s||l.completedAt){if("完了"!==s&&l.completedAt){let t={...e};Object.assign(t,{completedAt:(0,d.CL)()});let s=(0,d.H9)(a,"progress",l.id);await (0,d.mZ)(s,t);return}}else e.completedAt=n;let o=(0,d.H9)(a,"progress",l.id);await (0,d.mZ)(o,e)}else await (0,d.gS)((0,d.rJ)(a,"progress"),{taskId:e,orgId:t,status:s,memo:r||"",memoHistory:r?[{memo:r,orgId:t,timestamp:i}]:[],completedAt:"完了"===s?n:void 0,updatedAt:n})}catch(a){return console.error("Firebase error in createOrUpdateProgress:",a),x.createOrUpdateProgress(e,t,s,r)}}}function p(e){let{onLogin:t}=e,[s,l]=(0,a.useState)({role:"central",password:""}),[d,n]=(0,a.useState)([]),[o,c]=(0,a.useState)(""),[m,u]=(0,a.useState)(!1);(0,a.useEffect)(()=>{(async()=>{try{let e=await h.getOrganizations();n(e)}catch(e){console.error("Failed to load organizations:",e)}})()},[]);let x=e=>{l({role:e,password:"",orgId:void 0}),c("")},g=async e=>{e.preventDefault(),u(!0),c("");try{if(console.log("Login attempt:",{role:s.role,orgId:s.orgId}),!i.u.validateLogin(s)){console.log("Validation failed"),"central"===s.role?c("中央のパスワードが正しくありません（正解: 1050）"):c("パスワードが正しくないか、組織が選択されていません（パスワード: 1234）"),u(!1);return}let e="";if("central"===s.role)e="中央";else if(s.orgId){let t=d.find(e=>e.id===s.orgId);e=(null==t?void 0:t.name)||"",console.log("Found organization:",t)}let r={role:s.role,orgId:s.orgId,orgName:e,isAuthenticated:!0};console.log("Logging in with session:",r),u(!1),t(r)}catch(e){console.error("Login error:",e),c("ログイン処理でエラーが発生しました: "+e.message),u(!1)}},p=d.filter(e=>e.role===s.role&&"central"!==e.role);return(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100 px-4 py-8",children:(0,r.jsxs)("div",{className:"max-w-lg w-full space-y-8 bg-white rounded-xl shadow-xl p-8",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:"統合進捗管理システム"}),(0,r.jsx)("p",{className:"mt-2 text-center text-sm text-gray-600",children:"ログインしてください"})]}),(0,r.jsxs)("form",{className:"mt-8 space-y-6",onSubmit:g,children:[o&&(0,r.jsx)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:o}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"役割"}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("label",{className:"flex items-center",children:[(0,r.jsx)("input",{type:"radio",name:"role",value:"central",checked:"central"===s.role,onChange:e=>x(e.target.value),className:"mr-2"}),"中央"]}),(0,r.jsxs)("label",{className:"flex items-center",children:[(0,r.jsx)("input",{type:"radio",name:"role",value:"block",checked:"block"===s.role,onChange:e=>x(e.target.value),className:"mr-2"}),"ブロック"]}),(0,r.jsxs)("label",{className:"flex items-center",children:[(0,r.jsx)("input",{type:"radio",name:"role",value:"branch",checked:"branch"===s.role,onChange:e=>x(e.target.value),className:"mr-2"}),"支部"]}),(0,r.jsxs)("label",{className:"flex items-center",children:[(0,r.jsx)("input",{type:"radio",name:"role",value:"sub",checked:"sub"===s.role,onChange:e=>x(e.target.value),className:"mr-2"}),"分会"]})]})]}),"central"!==s.role&&(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"organization",className:"block text-sm font-medium text-gray-700",children:"組織"}),(0,r.jsxs)("select",{id:"organization",required:!0,value:s.orgId||"",onChange:e=>l({...s,orgId:e.target.value}),className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:[(0,r.jsx)("option",{value:"",children:"組織を選択してください"}),p.map(e=>(0,r.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:"パスワード"}),(0,r.jsx)("input",{id:"password",type:"password",required:!0,value:s.password,onChange:e=>l({...s,password:e.target.value}),className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"パスワードを入力してください"}),(0,r.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:"central"===s.role?"パスワードは管理者にお問い合わせください":"パスワードは各組織の管理者にお問い合わせください"})]})]}),(0,r.jsx)("div",{children:(0,r.jsx)("button",{type:"submit",disabled:m,className:"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:m?"ログイン中...":"ログイン"})})]})]})})}function b(e){let{tasks:t,onTaskCreated:s}=e,[l,i]=(0,a.useState)(!1),[d,n]=(0,a.useState)({title:"",category:"block",memo:""}),[o,c]=(0,a.useState)(!1),[m,u]=(0,a.useState)(""),x=async e=>{e.preventDefault(),c(!0),u("");try{let e=new Date().toISOString().split("T")[0];await h.createTask({title:d.title,category:d.category,kind:"common",createdByOrgId:"org_000",active:!0,memo:d.memo,createdAt:e,updatedAt:e}),n({title:"",category:"block",memo:""}),i(!1),s()}catch(e){console.error("Failed to create task:",e),u("タスクの作成に失敗しました")}finally{c(!1)}},g=async e=>{if(confirm("このタスクを削除しますか？関連する進捗データも削除されます。"))try{await h.deleteTask(e),s()}catch(e){console.error("Failed to delete task:",e),alert("タスクの削除に失敗しました")}};return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("h2",{className:"text-lg font-medium text-gray-900",children:"共通タスク管理"}),(0,r.jsx)("button",{onClick:()=>i(!0),disabled:l,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm font-medium disabled:opacity-50",children:"新規タスク追加"})]}),l&&(0,r.jsxs)("div",{className:"bg-gray-50 p-6 rounded-lg",children:[(0,r.jsx)("h3",{className:"text-md font-medium text-gray-900 mb-4",children:"新規共通タスク"}),m&&(0,r.jsx)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:m}),(0,r.jsxs)("form",{onSubmit:x,className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700",children:"タイトル *"}),(0,r.jsx)("input",{type:"text",id:"title",required:!0,maxLength:100,value:d.title,onChange:e=>n({...d,title:e.target.value}),className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"タスクのタイトルを入力してください"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"category",className:"block text-sm font-medium text-gray-700",children:"カテゴリ *"}),(0,r.jsxs)("select",{id:"category",required:!0,value:d.category,onChange:e=>n({...d,category:e.target.value}),className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:[(0,r.jsx)("option",{value:"block",children:"ブロック"}),(0,r.jsx)("option",{value:"branch",children:"支部"}),(0,r.jsx)("option",{value:"sub",children:"分会"})]})]}),(0,r.jsxs)("div",{className:"flex space-x-3",children:[(0,r.jsx)("button",{type:"submit",disabled:o,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm font-medium disabled:opacity-50",children:o?"作成中...":"作成"}),(0,r.jsx)("button",{type:"button",onClick:()=>{i(!1),n({title:"",category:"block",memo:""}),u("")},className:"bg-gray-300 hover:bg-gray-400 text-gray-800 px-4 py-2 rounded-md text-sm font-medium",children:"キャンセル"})]})]})]}),(0,r.jsx)("div",{className:"space-y-4",children:0===t.length?(0,r.jsx)("p",{className:"text-gray-500 text-center py-8",children:"共通タスクがありません"}):t.map(e=>(0,r.jsx)("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"flex justify-between items-start",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("h3",{className:"text-md font-medium text-gray-900",children:e.title}),(0,r.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[(e=>{switch(e){case"block":return"ブロック";case"branch":return"支部";case"sub":return"分会";default:return""}})(e.category),"共通"]})]}),e.memo&&(0,r.jsx)("p",{className:"mt-2 text-sm text-gray-600",children:e.memo}),(0,r.jsxs)("p",{className:"mt-1 text-xs text-gray-500",children:["作成日: ",e.createdAt," | 更新日: ",e.updatedAt]})]}),(0,r.jsx)("button",{onClick:()=>g(e.id),className:"text-red-600 hover:text-red-800 text-sm font-medium ml-4",children:"削除"})]})},e.id))})]})}function y(e){let{organizations:t,tasks:s,progress:l,selectedCategory:i}=e,[d,n]=(0,a.useState)([]),[o,c]=(0,a.useState)([]),[m,u]=(0,a.useState)("all"),[x,g]=(0,a.useState)(""),[h,p]=(0,a.useState)("all"),[b,y]=(0,a.useState)("summary"),[v,f]=(0,a.useState)(1),[j]=(0,a.useState)(20),N=(0,a.useMemo)(()=>{let e=t.filter(e=>e.role===i),s=[];return e.forEach(e=>{let t=d.filter(t=>t.orgId===e.id),r=t.filter(e=>"完了"===e.status).length,a=t.filter(e=>"進行中"===e.status).length,l=t.filter(e=>"未着手"===e.status).length,i=t.length;s.push({orgId:e.id,orgName:e.name,totalTasks:i,completedTasks:r,inProgressTasks:a,pendingTasks:l,completionRate:i>0?Math.round(r/i*1e3)/10:0})}),s.sort((e,t)=>t.completionRate-e.completionRate)},[d,t,i]);(0,a.useEffect)(()=>{let e=[];t.filter(e=>e.role===i).forEach(t=>{s.filter(e=>e.active&&("common"===e.kind&&e.category===i||"local"===e.kind&&e.createdByOrgId===t.id)).forEach(s=>{let r=l.find(e=>e.taskId===s.id&&e.orgId===t.id);e.push({taskId:s.id,taskTitle:s.title,taskMemo:s.memo,taskKind:s.kind,orgId:t.id,orgName:t.name,status:(null==r?void 0:r.status)||"未着手",progressMemo:null==r?void 0:r.memo,completedAt:null==r?void 0:r.completedAt,updatedAt:(null==r?void 0:r.updatedAt)||s.createdAt})})}),e.sort((e,t)=>new Date(t.updatedAt).getTime()-new Date(e.updatedAt).getTime()),n(e)},[t,s,l,i]),(0,a.useEffect)(()=>{let e=d;"all"!==h&&(e=e.filter(e=>e.orgId===h)),"all"!==m&&(e=e.filter(e=>e.status===m)),x&&(e=e.filter(e=>{var t;return e.taskTitle.toLowerCase().includes(x.toLowerCase())||e.orgName.toLowerCase().includes(x.toLowerCase())||(null==(t=e.progressMemo)?void 0:t.toLowerCase().includes(x.toLowerCase()))})),c(e),f(1)},[d,m,x,h]);let w=Math.ceil(o.length/j),k=o.slice((v-1)*j,v*j),O={all:d.length,未着手:d.filter(e=>"未着手"===e.status).length,進行中:d.filter(e=>"進行中"===e.status).length,完了:d.filter(e=>"完了"===e.status).length};return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex flex-col space-y-4",children:[(0,r.jsxs)("div",{className:"flex justify-between items-start",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("h2",{className:"text-lg font-medium text-gray-900",children:[(e=>{switch(e){case"block":return"ブロック";case"branch":return"支部";case"sub":return"分会";default:return""}})(i),"タスク詳細"]}),(0,r.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:["全",t.filter(e=>e.role===i).length,"組織 | 全",d.length,"件のタスク"]})]}),(0,r.jsxs)("div",{className:"flex rounded-md bg-gray-100 p-1",children:[(0,r.jsx)("button",{onClick:()=>y("summary"),className:"px-3 py-1 text-sm font-medium rounded ".concat("summary"===b?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"),children:"組織別集計"}),(0,r.jsx)("button",{onClick:()=>y("detailed"),className:"px-3 py-1 text-sm font-medium rounded ".concat("detailed"===b?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"),children:"詳細一覧"})]})]}),"detailed"===b&&(0,r.jsxs)("div",{className:"flex flex-col lg:flex-row space-y-2 lg:space-y-0 lg:space-x-4",children:[(0,r.jsxs)("select",{value:h,onChange:e=>p(e.target.value),className:"min-w-[180px] px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:[(0,r.jsxs)("option",{value:"all",children:["全","block"===i?"ブロック":"branch"===i?"支部":"分会"]}),t.filter(e=>e.role===i).map(e=>(0,r.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,r.jsxs)("select",{value:m,onChange:e=>u(e.target.value),className:"min-w-[160px] px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:[(0,r.jsxs)("option",{value:"all",children:["全ステータス (",O.all,")"]}),(0,r.jsxs)("option",{value:"未着手",children:["未着手 (",O["未着手"],")"]}),(0,r.jsxs)("option",{value:"進行中",children:["進行中 (",O["進行中"],")"]}),(0,r.jsxs)("option",{value:"完了",children:["完了 (",O["完了"],")"]})]}),(0,r.jsx)("input",{type:"text",placeholder:"タスク名・組織名・メモで検索",value:x,onChange:e=>g(e.target.value),className:"flex-1 min-w-[300px] px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]})]}),"summary"===b?(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:N.map(e=>(0,r.jsxs)("div",{className:"bg-white p-4 rounded-lg border border-gray-200 shadow-sm hover:shadow-md transition-shadow",children:[(0,r.jsxs)("div",{className:"flex justify-between items-start mb-3",children:[(0,r.jsx)("h3",{className:"font-medium text-gray-900 text-sm",children:e.orgName}),(0,r.jsxs)("span",{className:"text-xs px-2 py-1 rounded-full font-medium ".concat(e.completionRate>=80?"bg-green-100 text-green-800":e.completionRate>=60?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"),children:[e.completionRate,"%"]})]}),(0,r.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-gray-600",children:"総タスク"}),(0,r.jsx)("span",{className:"font-medium",children:e.totalTasks})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-green-600",children:"完了"}),(0,r.jsx)("span",{className:"font-medium text-green-600",children:e.completedTasks})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-yellow-600",children:"進行中"}),(0,r.jsx)("span",{className:"font-medium text-yellow-600",children:e.inProgressTasks})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-gray-600",children:"未着手"}),(0,r.jsx)("span",{className:"font-medium text-gray-600",children:e.pendingTasks})]})]}),(0,r.jsx)("div",{className:"mt-3",children:(0,r.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,r.jsx)("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:"".concat(e.completionRate,"%")}})})}),(0,r.jsx)("button",{onClick:()=>{p(e.orgId),y("detailed")},className:"mt-3 w-full text-xs text-blue-600 hover:text-blue-800 font-medium",children:"詳細を表示"})]},e.orgId))}):(0,r.jsx)(r.Fragment,{children:0===o.length?(0,r.jsx)("div",{className:"text-center py-12",children:(0,r.jsx)("p",{className:"text-gray-500",children:x||"all"!==m||"all"!==h?"条件に該当するタスクがありません":"タスクがありません"})}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"bg-white shadow overflow-hidden sm:rounded-md",children:(0,r.jsx)("ul",{className:"divide-y divide-gray-200",children:k.map(e=>(0,r.jsx)("li",{className:"px-6 py-4",children:(0,r.jsx)("div",{className:"flex items-start justify-between",children:(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-3 mb-2",children:[(0,r.jsx)("h3",{className:"text-sm font-medium text-gray-900 truncate",children:e.taskTitle}),(0,r.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat("common"===e.taskKind?"bg-blue-100 text-blue-800":"bg-purple-100 text-purple-800"),children:"common"===e.taskKind?"共通":"ローカル"}),(0,r.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat((e=>{switch(e){case"未着手":default:return"bg-gray-100 text-gray-800";case"進行中":return"bg-yellow-100 text-yellow-800";case"完了":return"bg-green-100 text-green-800"}})(e.status)),children:e.status})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-4 text-sm text-gray-500",children:[(0,r.jsxs)("span",{className:"flex items-center",children:[(0,r.jsx)("svg",{className:"mr-1.5 h-4 w-4",fill:"currentColor",viewBox:"0 0 20 20",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z",clipRule:"evenodd"})}),e.orgName]}),(0,r.jsxs)("span",{children:["更新日: ",e.updatedAt]}),e.completedAt&&(0,r.jsxs)("span",{className:"text-green-600",children:["完了日: ",e.completedAt]})]}),e.taskMemo&&(0,r.jsxs)("p",{className:"mt-2 text-sm text-gray-600",children:[(0,r.jsx)("span",{className:"font-medium",children:"タスク詳細:"})," ",e.taskMemo]}),e.progressMemo&&(0,r.jsx)("div",{className:"mt-2 p-2 bg-yellow-50 border-l-4 border-yellow-400 rounded",children:(0,r.jsxs)("p",{className:"text-sm text-gray-700",children:[(0,r.jsx)("span",{className:"font-medium text-yellow-800",children:"\uD83D\uDCDD 連絡事項:"})," ",e.progressMemo]})})]})})},"".concat(e.taskId,"-").concat(e.orgId)))})}),w>1&&(0,r.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 bg-white border-t border-gray-200 sm:px-6",children:[(0,r.jsxs)("div",{className:"flex-1 flex justify-between sm:hidden",children:[(0,r.jsx)("button",{onClick:()=>f(Math.max(v-1,1)),disabled:1===v,className:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"前へ"}),(0,r.jsx)("button",{onClick:()=>f(Math.min(v+1,w)),disabled:v===w,className:"ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"次へ"})]}),(0,r.jsxs)("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[(0,r.jsx)("div",{children:(0,r.jsxs)("p",{className:"text-sm text-gray-700",children:[(0,r.jsx)("span",{className:"font-medium",children:(v-1)*j+1}),"〜",(0,r.jsx)("span",{className:"font-medium",children:Math.min(v*j,o.length)}),"件 / 全",(0,r.jsx)("span",{className:"font-medium",children:o.length}),"件"]})}),(0,r.jsx)("div",{children:(0,r.jsxs)("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px","aria-label":"Pagination",children:[(0,r.jsx)("button",{onClick:()=>f(Math.max(v-1,1)),disabled:1===v,className:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:(0,r.jsx)("svg",{className:"h-5 w-5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z",clipRule:"evenodd"})})}),(()=>{let e,t;if(w<=5)e=1,t=w;else{let s=Math.floor(2.5);v<=s?(e=1,t=5):v+s>=w?(e=w-5+1,t=w):(e=v-s,t=v+s)}let s=[];for(let r=e;r<=t;r++)s.push(r);return s.map(e=>(0,r.jsx)("button",{onClick:()=>f(e),className:"relative inline-flex items-center px-4 py-2 border text-sm font-medium ".concat(v===e?"z-10 bg-blue-50 border-blue-500 text-blue-600":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50"),children:e},e))})(),(0,r.jsx)("button",{onClick:()=>f(Math.min(v+1,w)),disabled:v===w,className:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:(0,r.jsx)("svg",{className:"h-5 w-5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z",clipRule:"evenodd"})})})]})})]})]})]})}),"summary"===b&&"sub"===i?(0,r.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,r.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg",children:[(0,r.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:N.length}),(0,r.jsx)("div",{className:"text-sm text-blue-800",children:"分会数"})]}),(0,r.jsxs)("div",{className:"bg-green-50 p-4 rounded-lg",children:[(0,r.jsxs)("div",{className:"text-2xl font-bold text-green-600",children:[N.length>0?Math.round(N.reduce((e,t)=>e+t.completionRate,0)/N.length*10)/10:0,"%"]}),(0,r.jsx)("div",{className:"text-sm text-green-800",children:"平均完了率"})]}),(0,r.jsxs)("div",{className:"bg-yellow-50 p-4 rounded-lg",children:[(0,r.jsx)("div",{className:"text-2xl font-bold text-yellow-600",children:N.filter(e=>e.completionRate>=80).length}),(0,r.jsx)("div",{className:"text-sm text-yellow-800",children:"完了率80%以上"})]}),(0,r.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,r.jsx)("div",{className:"text-2xl font-bold text-gray-600",children:N.reduce((e,t)=>e+t.totalTasks,0)}),(0,r.jsx)("div",{className:"text-sm text-gray-800",children:"総タスク数"})]})]}):(0,r.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,r.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg",children:[(0,r.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:O.all}),(0,r.jsx)("div",{className:"text-sm text-blue-800",children:"all"!==h?"該当組織タスク数":"総タスク数"})]}),(0,r.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,r.jsx)("div",{className:"text-2xl font-bold text-gray-600",children:O["未着手"]}),(0,r.jsx)("div",{className:"text-sm text-gray-800",children:"未着手"})]}),(0,r.jsxs)("div",{className:"bg-yellow-50 p-4 rounded-lg",children:[(0,r.jsx)("div",{className:"text-2xl font-bold text-yellow-600",children:O["進行中"]}),(0,r.jsx)("div",{className:"text-sm text-yellow-800",children:"進行中"})]}),(0,r.jsxs)("div",{className:"bg-green-50 p-4 rounded-lg",children:[(0,r.jsx)("div",{className:"text-2xl font-bold text-green-600",children:O["完了"]}),(0,r.jsx)("div",{className:"text-sm text-green-800",children:"完了"})]})]})]})}function v(){let[e,t]=(0,a.useState)("overview"),[s,l]=(0,a.useState)([]),[i,d]=(0,a.useState)([]),[n,o]=(0,a.useState)([]),[c,m]=(0,a.useState)([]),[u,x]=(0,a.useState)("block"),[g,p]=(0,a.useState)(!0),v=(0,a.useCallback)((e,t,s)=>{let r=[];e.forEach(e=>{if("central"===e.role)return;let a=t.filter(t=>t.active&&("common"===t.kind&&t.category===e.role||"local"===t.kind&&t.createdByOrgId===e.id)),l=s.filter(t=>t.orgId===e.id&&"完了"===t.status&&a.some(e=>e.id===t.taskId)).length,i=a.length>0?Math.round(l/a.length*1e3)/10:0;r.push({orgId:e.id,orgName:e.name,totalTasks:a.length,completedTasks:l,progressRate:i})}),m(r)},[]),f=(0,a.useCallback)(async()=>{p(!0);try{let[e,t,s]=await Promise.all([h.getOrganizations(),h.getTasks(),h.getProgress()]);l(e),d(t),o(s),v(e,t,s)}catch(e){console.error("Failed to load data:",e)}finally{p(!1)}},[v]);(0,a.useEffect)(()=>{f()},[f]);let j=c.filter(e=>{let t=s.find(t=>t.id===e.orgId);return(null==t?void 0:t.role)===u});return g?(0,r.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)("div",{className:"border-b border-gray-200",children:(0,r.jsxs)("nav",{className:"-mb-px flex space-x-8","aria-label":"Tabs",children:[(0,r.jsx)("button",{onClick:()=>t("overview"),className:"whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm ".concat("overview"===e?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:"進捗一覧"}),(0,r.jsx)("button",{onClick:()=>t("details"),className:"whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm ".concat("details"===e?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:"タスク詳細"}),(0,r.jsx)("button",{onClick:()=>t("management"),className:"whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm ".concat("management"===e?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:"管理"})]})}),("overview"===e||"details"===e)&&(0,r.jsxs)("div",{className:"flex space-x-4",children:[(0,r.jsx)("button",{onClick:()=>x("block"),className:"px-4 py-2 rounded-md text-sm font-medium ".concat("block"===u?"bg-blue-600 text-white":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"),children:"ブロック"}),(0,r.jsx)("button",{onClick:()=>x("branch"),className:"px-4 py-2 rounded-md text-sm font-medium ".concat("branch"===u?"bg-blue-600 text-white":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"),children:"支部"}),(0,r.jsx)("button",{onClick:()=>x("sub"),className:"px-4 py-2 rounded-md text-sm font-medium ".concat("sub"===u?"bg-blue-600 text-white":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"),children:"分会"})]}),(0,r.jsxs)("div",{className:"bg-white shadow rounded-lg",children:["overview"===e&&(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsxs)("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:["block"===u?"ブロック":"branch"===u?"支部":"分会","進捗一覧"]}),(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,r.jsx)("thead",{className:"bg-gray-50",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"組織名"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"総タスク数"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"完了数"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"進捗率"})]})}),(0,r.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:j.map(e=>(0,r.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:e.orgName}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.totalTasks}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.completedTasks}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"flex-1 mr-2",children:(0,r.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,r.jsx)("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:"".concat(e.progressRate,"%")}})})}),(0,r.jsxs)("span",{className:"font-medium",children:[e.progressRate,"%"]})]})})]},e.orgId))})]})})]}),"details"===e&&(0,r.jsx)("div",{className:"p-6",children:(0,r.jsx)(y,{organizations:s,tasks:i,progress:n,selectedCategory:u})}),"management"===e&&(0,r.jsx)("div",{className:"p-6",children:(0,r.jsx)(b,{tasks:i.filter(e=>"common"===e.kind),onTaskCreated:()=>{f()}})})]})]})}function f(e){let{task:t,progress:s,onProgressUpdate:l}=e,[i,d]=(0,a.useState)(!1),[n,o]=(0,a.useState)((null==s?void 0:s.memo)||""),[c,m]=(0,a.useState)(!1),u=async e=>{m(!0);try{let r=n!==((null==s?void 0:s.memo)||"");await l(t.id,e,r?n:void 0)}finally{m(!1)}},x=async()=>{m(!0);try{let e=(null==s?void 0:s.status)||"未着手";await l(t.id,e,n),d(!1)}finally{m(!1)}},g=(null==s?void 0:s.status)||"未着手";return(0,r.jsxs)("div",{className:"bg-white p-4 rounded-lg border border-gray-200 shadow-sm hover:shadow-md transition-shadow",children:[(0,r.jsxs)("div",{className:"mb-3",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsx)("h4",{className:"font-medium text-gray-900 text-sm",children:t.title}),(0,r.jsx)("span",{className:"text-xs px-2 py-1 rounded-full ".concat("common"===t.kind?"bg-blue-100 text-blue-800":"bg-purple-100 text-purple-800"),children:"common"===t.kind?"共通":"ローカル"})]}),t.memo&&(0,r.jsx)("p",{className:"text-xs text-gray-600 mb-2",children:t.memo})]}),(0,r.jsxs)("div",{className:"mb-3",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("span",{className:"text-xs text-gray-500 mr-2",children:"ステータス:"}),(0,r.jsxs)("select",{value:g,onChange:e=>u(e.target.value),disabled:c,className:"px-3 py-1 rounded-full text-xs font-medium border-0 cursor-pointer focus:ring-2 focus:ring-blue-500 ".concat((e=>{switch(e){case"未着手":default:return"bg-gray-100 text-gray-800";case"進行中":return"bg-yellow-100 text-yellow-800";case"完了":return"bg-green-100 text-green-800"}})(g)," ").concat(c?"opacity-50 cursor-not-allowed":"hover:opacity-80"),children:[(0,r.jsx)("option",{value:"未着手",children:"未着手"}),(0,r.jsx)("option",{value:"進行中",children:"進行中"}),(0,r.jsx)("option",{value:"完了",children:"完了"})]})]}),(null==s?void 0:s.completedAt)&&(0,r.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["完了日: ",s.completedAt]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("button",{onClick:()=>d(!i),className:"text-xs text-blue-600 hover:text-blue-800",children:i?"連絡事項を閉じる":"中央への連絡事項を入力・編集"}),i&&(0,r.jsxs)("div",{className:"mt-2 space-y-2",children:[(0,r.jsx)("div",{className:"text-xs text-gray-600 mb-1",children:"中央への連絡事項があれば記入してください"}),(0,r.jsx)("textarea",{value:n,onChange:e=>o(e.target.value),maxLength:200,rows:3,className:"w-full text-xs p-3 border-2 border-blue-300 bg-blue-50 rounded resize-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 focus:bg-white",placeholder:"連絡事項を入力してください（200文字以内）"}),(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsxs)("span",{className:"text-xs text-gray-500",children:[n.length,"/200文字"]}),(0,r.jsxs)("div",{className:"space-x-1",children:[(0,r.jsx)("button",{onClick:x,disabled:c,className:"text-xs bg-blue-600 text-white px-2 py-1 rounded hover:bg-blue-700 disabled:opacity-50",children:"保存"}),(0,r.jsx)("button",{onClick:()=>{d(!1),o((null==s?void 0:s.memo)||"")},className:"text-xs bg-gray-300 text-gray-700 px-2 py-1 rounded hover:bg-gray-400",children:"キャンセル"})]})]})]})]}),(null==s?void 0:s.memoHistory)&&s.memoHistory.filter(e=>e.memo.trim()).length>0&&(0,r.jsxs)("details",{className:"text-xs",children:[(0,r.jsxs)("summary",{className:"text-blue-600 cursor-pointer hover:text-blue-800",children:["連絡履歴 (",s.memoHistory.filter(e=>e.memo.trim()).length,")"]}),(0,r.jsx)("div",{className:"mt-2 space-y-1 max-h-32 overflow-y-auto",children:s.memoHistory.filter(e=>e.memo.trim()).slice().reverse().map((e,t)=>(0,r.jsxs)("div",{className:"bg-gray-50 p-2 rounded border-l-2 border-blue-200",children:[(0,r.jsx)("p",{className:"text-gray-700",children:e.memo}),(0,r.jsx)("p",{className:"text-gray-500 text-xs mt-1",children:new Date(e.timestamp).toLocaleString("ja-JP")})]},t))})]})]})]})}function j(e){let{tasks:t,progress:s,onProgressUpdate:l}=e,[i,d]=(0,a.useState)(null),[n,o]=(0,a.useState)(null),[c,m]=(0,a.useState)({}),u=e=>s.find(t=>t.taskId===e),x=async(e,t)=>{let s=u(e);await l(e,t,null==s?void 0:s.memo)},g=async e=>{try{let t=u(e),s=(null==t?void 0:t.status)||"未着手";await l(e,s,c[e]||""),o(null)}catch(e){console.error("Failed to save memo:",e),alert("連絡事項の保存に失敗しました")}},h=e=>{d(i===e?null:e)};return(0,r.jsxs)("div",{className:"bg-white shadow rounded-lg overflow-hidden",children:[(0,r.jsx)("div",{className:"hidden md:block",children:(0,r.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,r.jsx)("thead",{className:"bg-gray-50",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"タスク"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"種別"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ステータス"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"完了日"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"操作"})]})}),(0,r.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:t.map(e=>{let t=u(e.id),s=(null==t?void 0:t.status)||"未着手";return(0,r.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,r.jsx)("td",{className:"px-6 py-4",children:(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.title}),e.memo&&(0,r.jsx)("div",{className:"text-sm text-gray-500 mt-1",children:e.memo})]})}),(0,r.jsx)("td",{className:"px-6 py-4",children:(0,r.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat("common"===e.kind?"bg-blue-100 text-blue-800":"bg-purple-100 text-purple-800"),children:"common"===e.kind?"共通":"ローカル"})}),(0,r.jsx)("td",{className:"px-6 py-4",children:(0,r.jsxs)("select",{value:s,onChange:t=>x(e.id,t.target.value),className:"text-sm border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",children:[(0,r.jsx)("option",{value:"未着手",children:"未着手"}),(0,r.jsx)("option",{value:"進行中",children:"進行中"}),(0,r.jsx)("option",{value:"完了",children:"完了"})]})}),(0,r.jsx)("td",{className:"px-6 py-4 text-sm text-gray-900",children:(null==t?void 0:t.completedAt)||"-"}),(0,r.jsx)("td",{className:"px-6 py-4",children:(0,r.jsx)("button",{onClick:()=>h(e.id),className:"text-blue-600 hover:text-blue-800 text-sm font-medium",children:i===e.id?"連絡事項を閉じる":"中央への連絡事項を入力・編集"})})]},e.id)})})]})}),(0,r.jsx)("div",{className:"md:hidden",children:t.map(e=>{let t=u(e.id),s=(null==t?void 0:t.status)||"未着手";return(0,r.jsxs)("div",{className:"border-b border-gray-200 p-4",children:[(0,r.jsxs)("div",{className:"flex justify-between items-start mb-3",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("h3",{className:"text-sm font-medium text-gray-900",children:e.title}),e.memo&&(0,r.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:e.memo})]}),(0,r.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ml-2 ".concat("common"===e.kind?"bg-blue-100 text-blue-800":"bg-purple-100 text-purple-800"),children:"common"===e.kind?"共通":"ローカル"})]}),(0,r.jsxs)("div",{className:"mb-3",children:[(0,r.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"ステータス"}),(0,r.jsxs)("select",{value:s,onChange:t=>x(e.id,t.target.value),className:"w-full text-sm border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",children:[(0,r.jsx)("option",{value:"未着手",children:"未着手"}),(0,r.jsx)("option",{value:"進行中",children:"進行中"}),(0,r.jsx)("option",{value:"完了",children:"完了"})]})]}),(null==t?void 0:t.completedAt)&&(0,r.jsxs)("p",{className:"text-xs text-gray-500 mb-3",children:["完了日: ",t.completedAt]}),(0,r.jsx)("button",{onClick:()=>h(e.id),className:"text-blue-600 hover:text-blue-800 text-sm font-medium",children:i===e.id?"連絡事項を閉じる":"中央への連絡事項を入力・編集"})]},e.id)})}),i&&(0,r.jsx)("div",{className:"border-t border-gray-200 bg-gray-50 p-6",children:(()=>{let e=t.find(e=>e.id===i),s=u(i);return e?(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("h4",{className:"font-medium text-gray-900",children:["タスク詳細: ",e.title]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"中央への連絡事項"}),(0,r.jsx)("p",{className:"text-xs text-gray-600 mb-2",children:"中央への連絡事項があれば記入してください"}),n===e.id?(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("textarea",{value:c[e.id]||"",onChange:t=>m({...c,[e.id]:t.target.value}),maxLength:200,rows:3,className:"w-full text-sm p-3 border-2 border-blue-300 bg-blue-50 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 focus:bg-white",placeholder:"連絡事項を入力してください（200文字以内）"}),(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsxs)("span",{className:"text-xs text-gray-500",children:[(c[e.id]||"").length,"/200文字"]}),(0,r.jsxs)("div",{className:"space-x-2",children:[(0,r.jsx)("button",{onClick:()=>g(e.id),className:"text-sm bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700",children:"保存"}),(0,r.jsx)("button",{onClick:()=>{var t;return t=e.id,void(o(null),m({...c,[t]:""}))},className:"text-sm bg-gray-300 text-gray-700 px-3 py-1 rounded hover:bg-gray-400",children:"キャンセル"})]})]})]}):(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("div",{className:"text-sm text-gray-600 min-h-[60px] p-3 bg-white border border-gray-300 rounded-md",children:(null==s?void 0:s.memo)||"連絡事項はありません"}),(0,r.jsx)("button",{onClick:()=>(e=>{let t=u(e);m({...c,[e]:(null==t?void 0:t.memo)||""}),o(e)})(e.id),className:"text-sm text-blue-600 hover:text-blue-800",children:"編集"})]})]}),(null==s?void 0:s.memoHistory)&&s.memoHistory.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsxs)("h5",{className:"text-sm font-medium text-gray-700 mb-2",children:["連絡履歴 (",s.memoHistory.filter(e=>e.memo.trim()).length,")"]}),(0,r.jsx)("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:s.memoHistory.filter(e=>e.memo.trim()).slice().reverse().map((e,t)=>(0,r.jsxs)("div",{className:"bg-white p-3 rounded border-l-4 border-blue-200",children:[(0,r.jsx)("p",{className:"text-sm text-gray-700",children:e.memo}),(0,r.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:new Date(e.timestamp).toLocaleString("ja-JP")})]},t))})]})]}):null})()})]})}function N(e){let{onSubmit:t,onCancel:s}=e,{user:i}=(0,l.A)(),[d,n]=(0,a.useState)(""),[o,c]=(0,a.useState)(!1),[m,u]=(0,a.useState)(""),x=async e=>{if(e.preventDefault(),!(null==i?void 0:i.orgId)||!(null==i?void 0:i.role))return void u("ユーザー情報が不正です");if(!d.trim())return void u("タイトルを入力してください");c(!0),u("");try{let e=new Date().toISOString().split("T")[0];await h.createTask({title:d.trim(),category:i.role,kind:"local",createdByOrgId:i.orgId,active:!0,memo:"",createdAt:e,updatedAt:e}),t()}catch(e){console.error("Failed to create local task:",e),u("タスクの作成に失敗しました")}finally{c(!1)}},g=()=>{switch(null==i?void 0:i.role){case"block":return"ブロック";case"branch":return"支部";case"sub":return"分会";default:return""}};return(0,r.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-6 shadow-sm",children:[(0,r.jsxs)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:["新規ローカルタスク作成 (",g(),")"]}),m&&(0,r.jsx)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:m}),(0,r.jsxs)("form",{onSubmit:x,className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700 mb-1",children:"タイトル *"}),(0,r.jsx)("input",{type:"text",id:"title",required:!0,maxLength:100,value:d,onChange:e=>n(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"タスクのタイトルを入力してください",disabled:o}),(0,r.jsxs)("p",{className:"mt-1 text-sm text-gray-500",children:[d.length,"/100文字"]})]}),(0,r.jsx)("div",{className:"bg-gray-50 p-3 rounded-md",children:(0,r.jsxs)("p",{className:"text-sm text-gray-600",children:[(0,r.jsx)("strong",{children:"カテゴリ:"})," ",g(),(0,r.jsx)("br",{}),(0,r.jsx)("strong",{children:"種別:"})," ローカル",(0,r.jsx)("br",{}),(0,r.jsx)("strong",{children:"作成者:"})," ",null==i?void 0:i.orgName]})}),(0,r.jsxs)("div",{className:"flex space-x-3 pt-4",children:[(0,r.jsx)("button",{type:"submit",disabled:o||!d.trim(),className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-md text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:o?"作成中...":"作成"}),(0,r.jsx)("button",{type:"button",onClick:s,disabled:o,className:"bg-gray-300 hover:bg-gray-400 text-gray-800 px-6 py-2 rounded-md text-sm font-medium disabled:opacity-50",children:"キャンセル"})]})]})]})}function w(){let{user:e}=(0,l.A)(),[t,s]=(0,a.useState)([]),[i,d]=(0,a.useState)([]),[n,o]=(0,a.useState)(!0),[c,m]=(0,a.useState)("table"),[u,x]=(0,a.useState)(!1),g=(0,a.useCallback)(async()=>{if(null==e?void 0:e.orgId){o(!0);try{let[t,r,a]=await Promise.all([h.getTasksByCategory(e.role),h.getTasksByOrganization(e.orgId),h.getProgressByOrganization(e.orgId)]),l=[...t,...r];s(l),d(a)}catch(e){console.error("Failed to load data:",e)}finally{o(!1)}}},[e]);(0,a.useEffect)(()=>{g()},[g]);let p=async(t,s,r)=>{if(null==e?void 0:e.orgId)try{await h.createOrUpdateProgress(t,e.orgId,s,r),await g()}catch(e){console.error("Failed to update progress:",e),alert("進捗の更新に失敗しました")}},b=e=>i.find(t=>t.taskId===e),y={未着手:t.filter(e=>{let t=b(e.id);return!t||"未着手"===t.status}),進行中:t.filter(e=>{let t=b(e.id);return(null==t?void 0:t.status)==="進行中"}),完了:t.filter(e=>{let t=b(e.id);return(null==t?void 0:t.status)==="完了"})},v=window.innerWidth<768;return((0,a.useEffect)(()=>{let e=()=>{window.innerWidth<768&&"kanban"===c&&m("table")};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[c]),n)?(0,r.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center space-y-4 sm:space-y-0",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"タスク管理"}),(0,r.jsxs)("p",{className:"text-gray-600",children:["総タスク数: ",t.length," | 完了: ",y["完了"].length," | 進行中: ",y["進行中"].length," | 未着手: ",y["未着手"].length]})]}),(0,r.jsxs)("div",{className:"flex space-x-2",children:[!v&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{onClick:()=>m("table"),className:"px-4 py-2 text-sm font-medium rounded-md ".concat("table"===c?"bg-blue-600 text-white":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"),children:"テーブル"}),(0,r.jsx)("button",{onClick:()=>m("kanban"),className:"px-4 py-2 text-sm font-medium rounded-md ".concat("kanban"===c?"bg-blue-600 text-white":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"),children:"カンバン"})]}),(0,r.jsx)("button",{onClick:()=>x(!0),className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md text-sm font-medium",children:"ローカルタスク追加"})]})]}),u&&(0,r.jsx)(N,{onSubmit:()=>{x(!1),g()},onCancel:()=>x(!1)}),0===t.length?(0,r.jsx)("div",{className:"text-center py-12",children:(0,r.jsx)("p",{className:"text-gray-500",children:"タスクがありません"})}):(0,r.jsx)(r.Fragment,{children:"table"===c||v?(0,r.jsx)(j,{tasks:t,progress:i,onProgressUpdate:p}):(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:["未着手","進行中","完了"].map(e=>(0,r.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,r.jsxs)("h3",{className:"font-medium text-gray-900 mb-4 flex items-center",children:[e,(0,r.jsx)("span",{className:"ml-2 bg-gray-200 text-gray-700 text-sm px-2 py-1 rounded-full",children:y[e].length})]}),(0,r.jsxs)("div",{className:"space-y-3",children:[y[e].map(e=>(0,r.jsx)(f,{task:e,progress:b(e.id),onProgressUpdate:p},e.id)),0===y[e].length&&(0,r.jsx)("p",{className:"text-gray-500 text-sm text-center py-4",children:"タスクなし"})]})]},e))})})]})}function k(){let{user:e,logout:t}=(0,l.A)();return e?(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,r.jsx)("header",{className:"bg-blue-600 text-white shadow-lg",children:(0,r.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,r.jsxs)("div",{className:"flex justify-between items-center py-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-xl font-semibold",children:"統合進捗管理システム"}),(0,r.jsx)("p",{className:"text-blue-100 text-sm",children:e.orgName})]}),(0,r.jsx)("button",{onClick:()=>{t()},className:"bg-blue-700 hover:bg-blue-800 px-4 py-2 rounded-md text-sm font-medium transition-colors",children:"ログアウト"})]})})}),(0,r.jsx)("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:"central"===e.role?(0,r.jsx)(v,{}):(0,r.jsx)(w,{})})]}):null}function O(){let{user:e,login:t,isLoading:s}=(0,l.A)(),[i,d]=(0,a.useState)(!1);return((0,a.useEffect)(()=>{d(!0)},[]),!i||s)?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600"})}):(null==e?void 0:e.isAuthenticated)?(0,r.jsx)(k,{}):(0,r.jsx)(p,{onLogin:t})}}},e=>{e.O(0,[135,736,441,255,358],()=>e(e.s=7333)),_N_E=e.O()}]);